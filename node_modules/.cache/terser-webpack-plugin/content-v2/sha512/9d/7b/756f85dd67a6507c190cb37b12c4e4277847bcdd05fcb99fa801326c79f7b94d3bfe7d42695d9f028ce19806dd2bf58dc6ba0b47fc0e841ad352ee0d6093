{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{226:function(e,s,a){\"use strict\";a.r(s);var t=a(0),l=Object(t.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var e=this,s=e.$createElement,a=e._self._c||s;return a(\"div\",{staticClass:\"content\"},[a(\"h2\",{attrs:{id:\"dockercompose-服务编排\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#dockercompose-服务编排\",\"aria-hidden\":\"true\"}},[e._v(\"#\")]),e._v(\" DockerCompose 服务编排\")]),e._v(\" \"),a(\"h3\",{attrs:{id:\"概述\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#概述\",\"aria-hidden\":\"true\"}},[e._v(\"#\")]),e._v(\" 概述\")]),e._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[e._v(\"使用微服务架构的应用程序一般包含若干个微服务，每个微服务一般都会部署多个实例，如果每个微服务都要手动操作那效率会很低，Docker compose就是用来高效管理容器，提交部署效率。\")])]),e._v(\" \"),a(\"li\",[a(\"p\",[e._v(\"docker-compose 是一个用户定义和运行多个容器的 Docker 应用程序。在 Compose 中你可以使用 .yml 文件来配置你的应用服务。然后，只需要一个简单的命令，就可以创建并启动。\")])])]),e._v(\" \"),a(\"h3\",{attrs:{id:\"docker-compose-管理容器的结构\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#docker-compose-管理容器的结构\",\"aria-hidden\":\"true\"}},[e._v(\"#\")]),e._v(\" Docker Compose 管理容器的结构\")]),e._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[e._v(\"Docker Compose将所管理的容器分为三层，分别是\"),a(\"strong\",[e._v(\"工程（project）\")]),e._v(\"、\"),a(\"strong\",[e._v(\"服务（service）\")]),e._v(\"、\"),a(\"strong\",[e._v(\"容器（container）\")])])]),e._v(\" \"),a(\"li\",[a(\"p\",[e._v(\"Docker Compose运行目录下所有的文件（docker-compose-yml、extends文件或者环境变量文件等）组成一个工程，一个工程可包含多个服务，每个服务中定义了容器运行的镜像，参与以及依赖，一个服务可以包含多个容器实例。\")])])]),e._v(\" \"),a(\"h3\",{attrs:{id:\"docker-compose-yml-常用指令\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#docker-compose-yml-常用指令\",\"aria-hidden\":\"true\"}},[e._v(\"#\")]),e._v(\" docker-compose.yml 常用指令\")]),e._v(\" \"),a(\"ul\",[a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"image\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"指定镜像名称或者镜像id,如果该镜像不存在，会尝试pull\")])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"build\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"指定Dockerfile文件的路径，可以是一个路径。例如：\")])])])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"build: ./dir\\n\")])])]),a(\"ul\",[a(\"li\",[e._v(\"也可以是一个对象，用于指定Dockerfile和参数。例如：\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"build: ./dir\\n  context: Dockerfile-alternate\\n  args:\\n      buildno:1\\n\")])])]),a(\"ul\",[a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"command\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"覆盖容器启动后的默认执行命令：\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"command: bundle exec thin -p 3000\\n\")])])]),a(\"ul\",[a(\"li\",[e._v(\"也可以是个list,类似docker的CMD命令\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"command: [bundle,exec,thin,-p,3000]\\n\")])])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"links\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"链接到其它服务中的容器，可以指定服务名称和链接的别名使用SERVICE：ALIAS\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"web:\\n  links:\\n      - db\\n      - db:database\\n      - redis\\n\")])])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"external_links\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"表示链接到docker-compose.yml外的容器。甚至非Compose管理的容器\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"extenrnal_links:\\n  - redis_l\\n  - project_db_1:mysql\\n  - project_db_2:postgresql\\n\")])])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"ports\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"暴露的端口号，使用 \"),a(\"code\",[e._v(\"宿主机：容器端口\")]),e._v(\" 的格式,或者仅仅指定容器的端口（此时宿主机会随机是指定，类似docker run -P命令）\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v('ports:\\n - \"3000\"\\n - \"3000-5000\"\\n - \"8080:8080\"\\n - \"8000-9000\":\"8000-9000\"\\n - \"49100:22\"\\n - \"127.168.0.0.1:8001:8001\"\\n')])])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"expose\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"暴露端口，只将端口暴露给连接的服务，而不暴露给宿主机\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v('expose: \\n  - \"3000\"\\n')])])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"volumes\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"卷挂载路径的设置。可以设置宿主机路径或加上访问模式\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"volumes:\\n  - /var/lib/mysql\\n  - /opt/data:/var/lib/mysql\\n  - ~/configs:/etc/configs/:ro\\n\")])])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"volumes_from\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"从另一个服务或者容器挂载卷\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"volumes_from:\\n  - service_name\\n  - servie_name:ro\\n  - container:container_name\\n\")])])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"environment\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"设置环境变量，可以使用数组或者字典两种方式，只有一个key的环境变量可以运行在compose机器上找到对应的\")])])])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"environment:\\n    RACK_ENV: development\\n    SHOW: 'true'\\n    SESSION_SECRET:\\n\")])])]),a(\"ul\",[a(\"li\",[a(\"strong\",[e._v(\"env_file\")]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"从文件中获取环境变量，可以为单独的文件路径或者列表\")])])])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v(\"env_file:\\n   - ./common.env\\n   - ./apps/web.env\\n   _ /opt/secrets.env\\n\")])])]),a(\"ul\",[a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"extends\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"继承另一个服务，基于已有的服务拓展\")])])]),e._v(\" \"),a(\"li\",[a(\"p\",[a(\"strong\",[e._v(\"net\")])]),e._v(\" \"),a(\"ul\",[a(\"li\",[e._v(\"设置网络模式\")])]),e._v(\" \"),a(\"div\",{staticClass:\"language-sh extra-class\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[e._v('net: \"bridge\"\\nnet: \"host\"\\nnet: \"none\"\\nnet: \"container:[service name or container name/id]\"\\n')])])])])])])}],!1,null,null,null);s.default=l.exports}}]);","extractedComments":[]}