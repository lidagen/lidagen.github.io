{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{251:function(t,e,_){\"use strict\";_.r(e);var a=_(0),v=Object(a.a)({},(function(){var t=this,e=t.$createElement,_=t._self._c||e;return _(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[_(\"h2\",{attrs:{id:\"企业级解决方案\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#企业级解决方案\"}},[t._v(\"#\")]),t._v(\" 企业级解决方案\")]),t._v(\" \"),_(\"h3\",{attrs:{id:\"缓存预热\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#缓存预热\"}},[t._v(\"#\")]),t._v(\" 缓存预热\")]),t._v(\" \"),_(\"h4\",{attrs:{id:\"现象\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#现象\"}},[t._v(\"#\")]),t._v(\" 现象\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"服务器启动后快速宕机\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"原因\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#原因\"}},[t._v(\"#\")]),t._v(\" 原因\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"请求数量较大\")]),t._v(\" \"),_(\"li\",[t._v(\"主从之间数据吞吐量比较大，数据同步操作频率高\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"解决方案\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#解决方案\"}},[t._v(\"#\")]),t._v(\" 解决方案\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"前置准备工作\\n\"),_(\"ul\",[_(\"li\",[t._v(\"日常例行统计数据访问记录，统计访问频度较高的热度数据\")]),t._v(\" \"),_(\"li\",[t._v(\"利用LRU数据删除策略，构建数据保留队列\")])])]),t._v(\" \"),_(\"li\",[t._v(\"准备工作\\n\"),_(\"ul\",[_(\"li\",[t._v(\"将统计结果中的数据分类，根据级别，redis优先加载级别较高的热点数据\")]),t._v(\" \"),_(\"li\",[t._v(\"利用分布式多服务器同时进行数据读取，提速数据加载过程\")])])]),t._v(\" \"),_(\"li\",[t._v(\"实施\\n\"),_(\"ul\",[_(\"li\",[t._v(\"使用脚本固定触发数据预热过程\")]),t._v(\" \"),_(\"li\",[t._v(\"如果条件允许，使用CDN\")])])])]),t._v(\" \"),_(\"h3\",{attrs:{id:\"缓存雪崩\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#缓存雪崩\"}},[t._v(\"#\")]),t._v(\" 缓存雪崩\")]),t._v(\" \"),_(\"h4\",{attrs:{id:\"现象-2\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#现象-2\"}},[t._v(\"#\")]),t._v(\" 现象\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"系统运行过程突然数据库访问激增\")]),t._v(\" \"),_(\"li\",[t._v(\"导致数据库崩溃引发应用服务器崩溃\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"原因-2\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#原因-2\"}},[t._v(\"#\")]),t._v(\" 原因\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"在一个较短时间内，缓存中较多的\"),_(\"strong\",[t._v(\"key集中过期\")])]),t._v(\" \"),_(\"li\",[t._v(\"大量请求未命中redis,从而给数据库带来大的压力\")]),t._v(\" \"),_(\"li\",[t._v(\"应用服务器，redis,数据库的重启效果不明显\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"解决方案-2\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#解决方案-2\"}},[t._v(\"#\")]),t._v(\" 解决方案\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"解决方案1\\n\"),_(\"ul\",[_(\"li\",[t._v(\"更多页面静态化处理\")]),t._v(\" \"),_(\"li\",[t._v(\"构建多级缓存架构\\n\"),_(\"ul\",[_(\"li\",[t._v(\"nginx+redis+ehcache\")])])]),t._v(\" \"),_(\"li\",[t._v(\"对数据库查询进行优化\")]),t._v(\" \"),_(\"li\",[t._v(\"灾难预警：\\n\"),_(\"ul\",[_(\"li\",[t._v(\"监控CPU使用\")]),t._v(\" \"),_(\"li\",[t._v(\"内存容量\")]),t._v(\" \"),_(\"li\",[t._v(\"平均响应时间\")]),t._v(\" \"),_(\"li\",[t._v(\"线程数\")])])]),t._v(\" \"),_(\"li\",[t._v(\"服务限流、熔断\")])])]),t._v(\" \"),_(\"li\",[t._v(\"解决方案2\\n\"),_(\"ul\",[_(\"li\",[t._v(\"LRU和LFU的切换\")]),t._v(\" \"),_(\"li\",[t._v(\"数据有效期策略\\n\"),_(\"ul\",[_(\"li\",[t._v(\"根据业务不同，key失效时间错峰\")]),t._v(\" \"),_(\"li\",[t._v(\"过期时间使用固定时间+随机值，稀释集中到期key数量\")])])]),t._v(\" \"),_(\"li\",[t._v(\"定期维护，对即将过期的数据做访问量统计，确认是否需要延期\")]),t._v(\" \"),_(\"li\",[t._v(\"加锁：慎用\")])])])]),t._v(\" \"),_(\"h3\",{attrs:{id:\"缓存击穿\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#缓存击穿\"}},[t._v(\"#\")]),t._v(\" 缓存击穿\")]),t._v(\" \"),_(\"h4\",{attrs:{id:\"现象-3\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#现象-3\"}},[t._v(\"#\")]),t._v(\" 现象\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"系统运**行中，数据库访问激增\")]),t._v(\" \"),_(\"li\",[t._v(\"redis服务器无大量key过期，CPU正常，内存平稳无波动\")]),t._v(\" \"),_(\"li\",[t._v(\"数据库崩溃\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"原因-3\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#原因-3\"}},[t._v(\"#\")]),t._v(\" 原因\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[_(\"strong\",[t._v(\"单个key\")]),t._v(\"过期，而这个key访问量很大\")]),t._v(\" \"),_(\"li\",[t._v(\"大量对这个key的请求，redis未命中，短时间对数据库发起大量访问\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"解决方案-3\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#解决方案-3\"}},[t._v(\"#\")]),t._v(\" 解决方案\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"预先对可能的高热key加大过期时长\")]),t._v(\" \"),_(\"li\",[t._v(\"实时对流量激增的key延长过期时间或者设置永久key\")]),t._v(\" \"),_(\"li\",[t._v(\"对可能的高峰访问前，提前刷新数据有效期，确保key在访问时不过期\")]),t._v(\" \"),_(\"li\",[t._v(\"分布式锁，防止被击穿，但是也影响性能\")])]),t._v(\" \"),_(\"h3\",{attrs:{id:\"缓存穿透\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#缓存穿透\"}},[t._v(\"#\")]),t._v(\" 缓存穿透\")]),t._v(\" \"),_(\"h4\",{attrs:{id:\"现象-4\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#现象-4\"}},[t._v(\"#\")]),t._v(\" 现象\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"应用服务器访问增加，redis命中\"),_(\"strong\",[t._v(\"逐步降低\")])]),t._v(\" \"),_(\"li\",[t._v(\"redis服务器CPU占用激增\")]),t._v(\" \"),_(\"li\",[t._v(\"数据库压力激增\")]),t._v(\" \"),_(\"li\",[t._v(\"数据库崩溃\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"原因-4\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#原因-4\"}},[t._v(\"#\")]),t._v(\" 原因\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"大量非正常URL，要获取的数据根本不存在\")]),t._v(\" \"),_(\"li\",[t._v(\"redis中没有这些数据，所以去请求数据库\")]),t._v(\" \"),_(\"li\",[t._v(\"可能的黑客攻击\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"解决方案1\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#解决方案1\"}},[t._v(\"#\")]),t._v(\" 解决方案1\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"redis对没有的数据缓存null,设置较短过期时间（<5min）\")]),t._v(\" \"),_(\"li\",[t._v(\"白名单策略\\n\"),_(\"ul\",[_(\"li\",[t._v(\"提前预热各种分类数据id对于的bitmaps,当数据正常放行，数据异常拦截（效率较低）\")]),t._v(\" \"),_(\"li\",[t._v(\"布隆过滤器（布隆过滤器命中率这种情况可以忽略）\")])])]),t._v(\" \"),_(\"li\",[t._v(\"实施监控\\n\"),_(\"ul\",[_(\"li\",[t._v(\"监控redis命中率与null数据的占比\\n\"),_(\"ul\",[_(\"li\",[t._v(\"非活动时间波动，通常检测3～5倍，超过5纳入排查\")]),t._v(\" \"),_(\"li\",[t._v(\"活动时间波动，通村检测10～50倍，超过50纳入排查\")])])])])]),t._v(\" \"),_(\"li\",[t._v(\"key加密\\n\"),_(\"ul\",[_(\"li\",[t._v(\"问题出现后，临时启动防灾业务key,对key进行业务层传输加密，设定校验程序，对key校验（例如每天随机分配60个加密串，挑选2～3个，混淆在页面数据id中，发现key不满足规则，驳回请求）\")])]),t._v(\" \"),_(\"h3\",{attrs:{id:\"数据库与redis双写一致性\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#数据库与redis双写一致性\"}},[t._v(\"#\")]),t._v(\" 数据库与redis双写一致性\")])])]),t._v(\" \"),_(\"h3\",{attrs:{id:\"性能指标监控\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#性能指标监控\"}},[t._v(\"#\")]),t._v(\" 性能指标监控\")]),t._v(\" \"),_(\"h4\",{attrs:{id:\"监控指标\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#监控指标\"}},[t._v(\"#\")]),t._v(\" 监控指标\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"性能指标：Performance\")]),t._v(\" \"),_(\"li\",[t._v(\"内存指标：Memory\")]),t._v(\" \"),_(\"li\",[t._v(\"基本活动指标：Basicactivity\")]),t._v(\" \"),_(\"li\",[t._v(\"持久性指标：Persistence\")]),t._v(\" \"),_(\"li\",[t._v(\"错误指标：Error\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"性能指标：performance\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#性能指标：performance\"}},[t._v(\"#\")]),t._v(\" 性能指标：Performance\")]),t._v(\" \"),_(\"table\",[_(\"thead\",[_(\"tr\",[_(\"th\",[t._v(\"NAME\")]),t._v(\" \"),_(\"th\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"DESC\")])])]),t._v(\" \"),_(\"tbody\",[_(\"tr\",[_(\"td\",[t._v(\"latency\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"redis响应一个请求的时间\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"OPS\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"每秒处理请求总数\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"hit rate\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"缓存命中率（计算出来的）\")])])])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"内存指标：memory\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#内存指标：memory\"}},[t._v(\"#\")]),t._v(\" 内存指标：Memory\")]),t._v(\" \"),_(\"table\",[_(\"thead\",[_(\"tr\",[_(\"th\",[t._v(\"NAME\")]),t._v(\" \"),_(\"th\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"DESC\")])])]),t._v(\" \"),_(\"tbody\",[_(\"tr\",[_(\"td\",[t._v(\"used_memory\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"已使用内存\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"mem_fragmentation_ratio\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"内存碎片率\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"evicted_keys\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"由于内存限制而被移除key数量\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"blocked clients\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"由于BLPOP、BRPOP等命令而阻塞的客户端\")])])])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"基本活动指标：basicactivity\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#基本活动指标：basicactivity\"}},[t._v(\"#\")]),t._v(\" 基本活动指标：Basicactivity\")]),t._v(\" \"),_(\"table\",[_(\"thead\",[_(\"tr\",[_(\"th\",[t._v(\"NAME\")]),t._v(\" \"),_(\"th\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"DESC\")])])]),t._v(\" \"),_(\"tbody\",[_(\"tr\",[_(\"td\",[t._v(\"connected_clients\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"客户端连接数\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"connected_slaves\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"slave数量\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"master_last_io_senconds_ago\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"最近一次主从交互之后的秒数\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"keyspace\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"数据库key总数\")])])])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"持久性指标：persistence\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#持久性指标：persistence\"}},[t._v(\"#\")]),t._v(\" 持久性指标：Persistence\")]),t._v(\" \"),_(\"table\",[_(\"thead\",[_(\"tr\",[_(\"th\",[t._v(\"NAME\")]),t._v(\" \"),_(\"th\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"DESC\")])])]),t._v(\" \"),_(\"tbody\",[_(\"tr\",[_(\"td\",[t._v(\"rdb_last_save_time\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"最后一次保存到磁盘的时间戳\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"rdb_changes_since_last_save\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"自最后一次持久化磁盘后的更改数\")])])])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"错误指标：error\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#错误指标：error\"}},[t._v(\"#\")]),t._v(\" 错误指标：Error\")]),t._v(\" \"),_(\"table\",[_(\"thead\",[_(\"tr\",[_(\"th\",[t._v(\"NAME\")]),t._v(\" \"),_(\"th\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"DESC\")])])]),t._v(\" \"),_(\"tbody\",[_(\"tr\",[_(\"td\",[t._v(\"rejected_connections\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"由于达到最大连接数maxcliens限制而被拒绝的连接数\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"keyspace_misses\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"key值查找未命中数\")])]),t._v(\" \"),_(\"tr\",[_(\"td\",[t._v(\"master_link_down_since_seconds\")]),t._v(\" \"),_(\"td\",{staticStyle:{\"text-align\":\"center\"}},[t._v(\"主从断开的秒数\")])])])]),t._v(\" \"),_(\"h3\",{attrs:{id:\"性能指标监控命令\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#性能指标监控命令\"}},[t._v(\"#\")]),t._v(\" 性能指标监控命令\")]),t._v(\" \"),_(\"h4\",{attrs:{id:\"监控工具\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#监控工具\"}},[t._v(\"#\")]),t._v(\" 监控工具\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"cloud insight redis\")]),t._v(\" \"),_(\"li\",[t._v(\"Prometheus\")]),t._v(\" \"),_(\"li\",[t._v(\"Redis-stat\")]),t._v(\" \"),_(\"li\",[t._v(\"Redis-faina\")]),t._v(\" \"),_(\"li\",[t._v(\"RedisLive\")]),t._v(\" \"),_(\"li\",[t._v(\"Zabbix\")])]),t._v(\" \"),_(\"h4\",{attrs:{id:\"监控命令\"}},[_(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#监控命令\"}},[t._v(\"#\")]),t._v(\" 监控命令\")]),t._v(\" \"),_(\"ul\",[_(\"li\",[t._v(\"benchmark\")])]),t._v(\" \"),_(\"div\",{staticClass:\"language-sh extra-class\"},[_(\"pre\",{pre:!0,attrs:{class:\"language-sh\"}},[_(\"code\",[_(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"#50个连接，10000次请求对应性能\")]),t._v(\"\\nredis-benchmark\\n\"),_(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"#100个连接，5000次请求对应性能\")]),t._v(\"\\nredis-benchmark -c \"),_(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"100\")]),t._v(\" -n \"),_(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"5000\")]),t._v(\"\\n\")])])]),_(\"ul\",[_(\"li\",[t._v(\"redis cli\\n\"),_(\"ul\",[_(\"li\",[t._v(\"monitor\")]),t._v(\" \"),_(\"li\",[t._v(\"showlog\")])])])]),t._v(\" \"),_(\"div\",{staticClass:\"language-sh extra-class\"},[_(\"pre\",{pre:!0,attrs:{class:\"language-sh\"}},[_(\"code\",[_(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"#命令 get 获取慢查询日志 len 获取慢查询条数 reset重置慢查询日志\")]),t._v(\"\\nshowlog \"),_(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"[\")]),t._v(\"operator\"),_(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[t._v(\"]\")]),t._v(\"\\n \"),_(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"#相关配置\")]),t._v(\"\\n slowlog-log-slower-than \"),_(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"1000\")]),t._v(\" \"),_(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"#设置慢查询时间下限\")]),t._v(\"\\n slowlog-max-len \"),_(\"span\",{pre:!0,attrs:{class:\"token number\"}},[t._v(\"100\")]),t._v(\" \"),_(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[t._v(\"#设置慢查询命令对应日志显示长度\")]),t._v(\"\\n````+\")])])])])}),[],!1,null,null,null);e.default=v.exports}}]);","extractedComments":[]}